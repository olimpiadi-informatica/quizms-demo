- type: start
  message0: start here
  nextStatement: null
  colour: 20
  tooltip: Execution starts here
  helpUrl: ""
  maxInstances: 1
  js: ""

- type: N
  message0: N
  output: Number
  colour: 20
  tooltip: number of rooms
  helpUrl: ""
  js: state.N

- type: current room
  message0: current room
  output: Number
  colour: 20
  tooltip: the number of the current room, 0 (garden) or from 1 to N (rooms)
  helpUrl: ""
  js: state.pos

- type: move
  message0: move %1
  args0:
    - type: field_dropdown
      options:
        - [right, "1"]
        - [left, "-1"]
  previousStatement: null
  nextStatement: null
  colour: 20
  tooltip: move to the room at the right/left of the current room
  helpUrl: ""
  js: |
    (function(i) {
      state.dir = i;
      if (state.pos+i > state.N)
        exit(false, "there is nothing to the right");
      if (state.pos+i < 0)
        exit(false, "there is nothing to the left");
      door = state.pos + Math.min(0, i);
      state.door[door] = true;
      pause();
      state.pos += i;
      pause();
      state.door[door] = false;
      if (state.light[state.pos-1] === 0)
        exit(false, "you arrived in a dark room");
    })(parseInt(%1));

- type: switch
  message0: press the %1 switch
  args0:
    - type: field_dropdown
      options:
        - [right, "1"]
        - [left, "-1"]
  previousStatement: null
  nextStatement: null
  colour: 20
  tooltip: press the switch that controls the room to the right/left
  helpUrl: ""
  js: |
    (function(i) {
      state.dir = i;
      if (state.pos+i > state.N)
        exit(false, "there is no room to the right");
      if (state.pos+i < 1)
        exit(false, "there is no room to the left");
      state.switch[2*state.pos-1+Math.max(i,0)] ^= 1;
      state.light[state.pos+i-1] ^= 1;
    })(parseInt(%1));

- type: light on
  message0: "%1 light %2"
  args0:
    - type: field_dropdown
      options:
        - [right, "1"]
        - [left, "-1"]
    - type: field_dropdown
      options:
        - [on, "1"]
        - [off, "0"]
  output: Boolean
  colour: 20
  tooltip: true if the light in the room to the right/left is on/off
  helpUrl: ""
  js: |
    (function(i,v) {
      state.dir = i;
      if (state.pos+i > state.N)
        exit(false, "there is no room to the right");
      if (state.pos+i < 1)
        exit(false, "there is no room to the left");
      return state.light[state.pos+i-1] === v;
    })(parseInt(%1), parseInt(%2))

- type: terminate
  message0: terminate
  previousStatement: null
  colour: 20
  tooltip: reach your friends
  helpUrl: ""
  js: |
    if (state.pos !== 0)
      exit(false, "you haven't reached the garden");
    for (i=0; i<state.N; i++)
      if (state.light[i] === 1)
        exit(false, "you haven't turned off the light in room " + (i+1));
    state.pos--;
    exit(true, "you have turned off all the lights and reached your friends, congrats!");
